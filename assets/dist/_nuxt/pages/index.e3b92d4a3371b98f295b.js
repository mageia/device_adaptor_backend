webpackJsonp([4],{"+ptz":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("h2",{staticClass:"title"},[t._v("\n        数据接入\n    ")]),n("el-card",{staticClass:"box-card"},[n("el-button",{staticClass:"pull-right mb20",attrs:{type:"primary",size:"medium"},on:{click:function(e){t.isModalShow=!0}}},[t._v("添加数据源")]),n("el-table",{attrs:{data:t.inputData,stripe:!0,size:"small",border:"","default-sort":{prop:"created_at",order:"descending"}}},[n("el-table-column",{attrs:{type:"index"}}),n("el-table-column",{attrs:{prop:"name_override",label:"名称",width:"200"}}),n("el-table-column",{attrs:{prop:"plugin_name",label:"类型"}}),n("el-table-column",{attrs:{prop:"interval",label:"采集频率"}}),n("el-table-column",{attrs:{prop:"address",label:"地址"}}),n("el-table-column",{attrs:{prop:"created_at",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("formatDate")(e.row.created_at))+"\n                ")]}}])}),n("el-table-column",{attrs:{label:"操作",width:"260"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:function(n){t.editData(e.row)}}},[t._v("编辑")]),n("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:function(n){t.editData(e.row,"point")}}},[t._v("编辑点表")]),n("el-button",{attrs:{type:"danger",size:"small",round:""},on:{click:function(n){t.confirmDelete(e.row)}}},[t._v("删除")])]}}])})],1)],1),n("el-dialog",{attrs:{title:"添加数据源",visible:t.isModalShow,width:"500px"},on:{"update:visible":function(e){t.isModalShow=e}}},[n("lean-form",{attrs:{"sample-data":t.inputsConfig,reset:t.isReset},on:{changeFormData:t.changeFormData}}),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.cancelForm}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.createDataSource}},[t._v("确 定")])],1)],1)],1)};r._withStripped=!0;var a={render:r,staticRenderFns:[]};e.a=a},"/TYz":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("A0zQ"),a=n("+ptz"),i=n("VU/8")(r.a,a.a,!1,null,null,null);i.options.__file="pages/index.vue",e.default=i.exports},"97Cl":function(t,e,n){"use strict";var r=n("ueV6"),a=n("GQpR"),i=n("VU/8")(r.a,a.a,!1,null,null,null);i.options.__file="components/lean-form.vue",e.a=i.exports},A0zQ:function(t,e,n){"use strict";var r=n("Xxa5"),a=n.n(r),i=n("mvHQ"),s=n.n(i),o=n("fZjL"),u=n.n(o),c=n("exGp"),l=n.n(c),f=n("Dd8w"),h=n.n(f),d=n("97Cl"),p=n("oqQY"),m=n.n(p),$=n("NYxO");e.a={components:{LeanForm:d.a},data:function(){return{isReset:!1,tableData:[],isModalShow:!1,form:{},currentDataSource:{},formLabelWidth:"80px",inputsConfig:null,inputType:[],inputData:[],units:["s","ms"]}},computed:h()({},Object($.mapGetters)(["jwt"])),filters:{formatDate:function(t){return t?m()(t).format("YYYY-MM-DD HH:mm:ss"):""}},methods:{getInitConfig:function(){var t=l()(a.a.mark(function t(){var e,n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$axios({method:"get",url:"/getConfigSample",headers:{Authorization:this.jwt}});case 2:e=t.sent,n=e.data,this.inputsConfig=n.inputs,this.inputType=u()(this.inputsConfig),window.localStorage.setItem("INPUT_PLUGIN_CONFIG",s()(this.inputsConfig)),window.localStorage.setItem("INPUT_PLUGIN_TYPE",s()(this.inputType));case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),geInitData:function(){var t=l()(a.a.mark(function t(){var e,n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$axios({method:"get",url:"/getCurrentConfig",headers:{Authorization:this.jwt}});case 2:e=t.sent,n=e.data,this.inputData=n.inputs;case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),createDataSource:function(){var t=l()(a.a.mark(function t(){var e,n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={plugin_name:this.form.plugin_name},this.form.fields.forEach(function(t){"combine"!==t.type?e[t.key]=t.value:e[t.key]=""+t.value+t.unit}),console.log(e),t.prev=3,t.next=6,this.$axios({method:"post",url:"/plugin/inputs/",headers:{Authorization:this.jwt},data:e});case 6:n=t.sent,this.inputData.splice(0,0,n.data),this.$message({message:"添加成功！",type:"success"}),this.resetForm(),this.isModalShow=!1,t.next=17;break;case 13:t.prev=13,t.t0=t.catch(3),console.log(t.t0),this.$message({message:s()(t.t0.data),type:"error"});case 17:case"end":return t.stop()}},t,this,[[3,13]])}));return function(){return t.apply(this,arguments)}}(),deleteKey:function(){var t=l()(a.a.mark(function t(){var e;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios({method:"delete",url:"/plugin/inputs/"+this.currentDataSource.id,headers:{Authorization:this.jwt}});case 3:(e=t.sent).data&&(this.inputData=e.data,this.$message({message:"删除成功！",type:"success"})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this.$message({message:"删除失败！",type:"error"});case 10:case"end":return t.stop()}},t,this,[[0,7]])}));return function(){return t.apply(this,arguments)}}(),editData:function(t,e){"point"===e?this.$router.push("/inputs/point/"+t.id):this.$router.push("/inputs/"+t.id)},confirmDelete:function(t){var e=this;this.currentDataSource=t,this.$confirm("确认要删除数据源： "+this.currentDataSource.name_override+"?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.deleteKey()})},changeFormData:function(t){this.form=t},resetForm:function(){this.isReset=!this.isReset},cancelForm:function(){this.isModalShow=!1,this.resetForm()}},beforeMount:function(){this.getInitConfig()},mounted:function(){var t=this;this.$nextTick(function(){t.geInitData()})}}},GQpR:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form",{ref:"leanForm",attrs:{model:t.form}},[t.isEditing?n("el-form-item",{attrs:{label:"类型","label-width":t.formLabelWidth}},[n("span",[t._v(t._s(t.currentType))])]):t._e(),t.isEditing?t._e():n("el-form-item",{attrs:{label:"类型","label-width":t.formLabelWidth}},[n("el-select",{attrs:{placeholder:"选择数据源类型"},model:{value:t.form.plugin_name,callback:function(e){t.$set(t.form,"plugin_name",e)},expression:"form.plugin_name"}},t._l(t.inputType,function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})}))],1),t._l(t.form.fields,function(e,r){return n("el-form-item",{key:r,attrs:{label:e.label,"label-width":t.formLabelWidth}},["input"===e.type?n("el-input",{attrs:{autoComplete:"off"},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}}):t._e(),"combine"===e.type?[n("el-input",{staticStyle:{width:"80px","margin-right":"10px"},attrs:{autoComplete:"off"},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}}),n("el-select",{staticStyle:{width:"70px"},model:{value:e.unit,callback:function(n){t.$set(e,"unit",n)},expression:"item.unit"}},t._l(t.units,function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})}))]:t._e(),"radio"===e.type?[n("el-radio-group",{model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}},[n("el-radio",{attrs:{label:!0}},[t._v("是")]),n("el-radio",{attrs:{label:!1}},[t._v("否")])],1)]:t._e(),"text"===e.type?n("el-input",{attrs:{type:"textarea",autoComplete:"off",rows:10},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}}):t._e()],2)})],2)],1)};r._withStripped=!0;var a={render:r,staticRenderFns:[]};e.a=a},oqQY:function(t,e,n){!function(e,n){t.exports=n()}(0,function(){"use strict";var t="millisecond",e="second",n="minute",r="hour",a="day",i="week",s="month",o="year",u=/^(\d{4})-?(\d{1,2})-?(\d{0,2})(.*?(\d{1,2}):(\d{1,2}):(\d{1,2}))?.?(\d{1,3})?$/,c=/\[.*?\]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},h={padStart:f,padZoneStr:function(t){var e=Math.abs(t),n=Math.floor(e/60),r=e%60;return(t<=0?"+":"-")+f(n,2,"0")+":"+f(r,2,"0")},monthDiff:function(t,e){var n=12*(e.year()-t.year())+(e.month()-t.month()),r=t.clone().add(n,"months"),a=e-r<0,i=t.clone().add(n+(a?-1:1),"months");return Number(-(n+(e-r)/(a?r-i:i-r)))},absFloor:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},prettyUnit:function(u){return{M:s,y:o,w:i,d:a,h:r,m:n,s:e,ms:t}[u]||String(u||"").toLowerCase().replace(/s$/,"")},isUndefined:function(t){return void 0===t}},d="en",p={};p[d]=l;var m=function(t){return t instanceof b},$=function(t,e,n){var r;if(!t)return null;if("string"==typeof t)p[t]&&(r=t),e&&(p[t]=e,r=t);else{var a=t.name;p[a]=t,r=a}return n||(d=r),r},y=function(t,e){if(m(t))return t.clone();var n=e||{};return n.date=t,new b(n)},v=function(t,e){return y(t,{locale:e.$L})},g=h;g.parseLocale=$,g.isDayjs=m,g.wrapper=v;var b=function(){function l(t){this.parse(t)}var f=l.prototype;return f.parse=function(t){var e,n;this.$d=null===(e=t.date)?new Date(NaN):g.isUndefined(e)?new Date:e instanceof Date?e:"string"==typeof e&&/.*[^Z]$/i.test(e)&&(n=e.match(u))?new Date(n[1],n[2]-1,n[3]||1,n[5]||0,n[6]||0,n[7]||0,n[8]||0):new Date(e),this.init(t)},f.init=function(t){this.$y=this.$d.getFullYear(),this.$M=this.$d.getMonth(),this.$D=this.$d.getDate(),this.$W=this.$d.getDay(),this.$H=this.$d.getHours(),this.$m=this.$d.getMinutes(),this.$s=this.$d.getSeconds(),this.$ms=this.$d.getMilliseconds(),this.$L=this.$L||$(t.locale,null,!0)||d},f.$utils=function(){return g},f.isValid=function(){return!("Invalid Date"===this.$d.toString())},f.$compare=function(t){return this.valueOf()-y(t).valueOf()},f.isSame=function(t){return 0===this.$compare(t)},f.isBefore=function(t){return this.$compare(t)<0},f.isAfter=function(t){return this.$compare(t)>0},f.year=function(){return this.$y},f.month=function(){return this.$M},f.day=function(){return this.$W},f.date=function(){return this.$D},f.hour=function(){return this.$H},f.minute=function(){return this.$m},f.second=function(){return this.$s},f.millisecond=function(){return this.$ms},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(t,u){var c=this,l=!!g.isUndefined(u)||u,f=function(t,e){var n=v(new Date(c.$y,e,t),c);return l?n:n.endOf(a)},h=function(t,e){return v(c.toDate()[t].apply(c.toDate(),l?[0,0,0,0].slice(e):[23,59,59,999].slice(e)),c)};switch(g.prettyUnit(t)){case o:return l?f(1,0):f(31,11);case s:return l?f(1,this.$M):f(0,this.$M+1);case i:return f(l?this.$D-this.$W:this.$D+(6-this.$W),this.$M);case a:case"date":return h("setHours",0);case r:return h("setMinutes",1);case n:return h("setSeconds",2);case e:return h("setMilliseconds",3);default:return this.clone()}},f.endOf=function(t){return this.startOf(t,!1)},f.$set=function(i,u){switch(g.prettyUnit(i)){case a:this.$d.setDate(this.$D+(u-this.$W));break;case"date":this.$d.setDate(u);break;case s:this.$d.setMonth(u);break;case o:this.$d.setFullYear(u);break;case r:this.$d.setHours(u);break;case n:this.$d.setMinutes(u);break;case e:this.$d.setSeconds(u);break;case t:this.$d.setMilliseconds(u)}return this.init(),this},f.set=function(t,e){return this.clone().$set(t,e)},f.add=function(t,u){var c=this;t=Number(t);var l,f=g.prettyUnit(u),h=function(e,n){var r=c.set("date",1).set(e,n+t);return r.set("date",Math.min(c.$D,r.daysInMonth()))},d=function(e){var n=new Date(c.$d);return n.setDate(n.getDate()+e*t),v(n,c)};if(f===s)return h(s,this.$M);if(f===o)return h(o,this.$y);if(f===a)return d(1);if(f===i)return d(7);switch(f){case n:l=6e4;break;case r:l=36e5;break;case e:l=1e3;break;default:l=1}var p=this.valueOf()+t*l;return v(p,this)},f.subtract=function(t,e){return this.add(-1*t,e)},f.format=function(t){var e=this,n=t||"YYYY-MM-DDTHH:mm:ssZ",r=g.padZoneStr(this.$d.getTimezoneOffset()),a=this.$locale(),i=a.weekdays,s=a.months,o=function(t,e,n,r){return t&&t[e]||n[e].substr(0,r)};return n.replace(c,function(t){if(t.indexOf("[")>-1)return t.replace(/\[|\]/g,"");switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return String(e.$y);case"M":return String(e.$M+1);case"MM":return g.padStart(e.$M+1,2,"0");case"MMM":return o(a.monthsShort,e.$M,s,3);case"MMMM":return s[e.$M];case"D":return String(e.$D);case"DD":return g.padStart(e.$D,2,"0");case"d":return String(e.$W);case"dd":return o(a.weekdaysMin,e.$W,i,2);case"ddd":return o(a.weekdaysShort,e.$W,i,3);case"dddd":return i[e.$W];case"H":return String(e.$H);case"HH":return g.padStart(e.$H,2,"0");case"h":case"hh":return 0===e.$H?12:g.padStart(e.$H<13?e.$H:e.$H-12,"hh"===t?2:1,"0");case"a":return e.$H<12?"am":"pm";case"A":return e.$H<12?"AM":"PM";case"m":return String(e.$m);case"mm":return g.padStart(e.$m,2,"0");case"s":return String(e.$s);case"ss":return g.padStart(e.$s,2,"0");case"SSS":return g.padStart(e.$ms,3,"0");case"Z":return r;default:return r.replace(":","")}})},f.diff=function(t,u,c){var l=g.prettyUnit(u),f=y(t),h=this-f,d=g.monthDiff(this,f);switch(l){case o:d/=12;break;case s:break;case"quarter":d/=3;break;case i:d=h/6048e5;break;case a:d=h/864e5;break;case r:d=h/36e5;break;case n:d=h/6e4;break;case e:d=h/1e3;break;default:d=h}return c?d:g.absFloor(d)},f.daysInMonth=function(){return this.endOf(s).$D},f.$locale=function(){return p[this.$L]},f.locale=function(t,e){var n=this.clone();return n.$L=$(t,e,!0),n},f.clone=function(){return v(this.toDate(),this)},f.toDate=function(){return new Date(this.$d)},f.toArray=function(){return[this.$y,this.$M,this.$D,this.$H,this.$m,this.$s,this.$ms]},f.toJSON=function(){return this.toISOString()},f.toISOString=function(){return this.toDate().toISOString()},f.toObject=function(){return{years:this.$y,months:this.$M,date:this.$D,hours:this.$H,minutes:this.$m,seconds:this.$s,milliseconds:this.$ms}},f.toString=function(){return this.$d.toUTCString()},l}();return y.extend=function(t,e){return t(e,b,y),y},y.locale=$,y.isDayjs=m,y.unix=function(t){return y(1e3*t)},y.en=p[d],y})},ueV6:function(t,e,n){"use strict";var r=n("fZjL"),a=n.n(r);e.a={name:"lean-form",props:{sampleData:{type:Object,default:function(){return{}}},reset:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},formData:{type:Object,default:function(){return{}}},currentType:{type:String,default:""}},data:function(){return{formLabelWidth:"140px",form:{plugin_name:"",fields:[]},units:["s","ms"]}},computed:{dataType:function(){return console.log(this.form.plugin_name),this.form.plugin_name},inputType:function(){return a()(this.sampleData)}},watch:{currentType:function(t,e){console.log(this.formData),this.formatForm()},dataType:function(t,e){this.formatForm()},"form.fields":{handler:function(){console.log(this.form),this.$emit("changeFormData",this.form)},deep:!0},reset:function(t,e){this.resetForm()}},methods:{formatForm:function(){var t=this;this.form.fields=[];var e=this.isEditing?this.currentType:this.dataType;e&&a()(this.sampleData).length>0&&this.sampleData[e].forEach(function(e,n){if("none"!==e.Type&&"plugin_name"!==e.Key)if("combine"===e.Type){var r=t.isEditing?t.formData[e.Key]:e.Default,a=/[a-z]*$/.exec(r)[0],i=/^[0-9]*/.exec(r)[0];t.form.fields.push({key:e.Key,value:i,label:e.Label,type:e.Type,unit:a})}else{if("text"===e.Type&&!t.isEditing)return;t.form.fields.push({key:e.Key,value:t.isEditing?t.formData[e.Key]:e.Default,label:e.Label,type:e.Type})}})},formChange:function(){console.log("change")},resetForm:function(){this.form={plugin_name:"",fields:[]}}},mounted:function(){var t=this;this.$nextTick(function(){t.formatForm()})}}}});